estate_commoners = {
	icon = 4
	
	color = { 77 155 76 }
	
	keep_on_conquest = no 							
	always_remove_on_religious_conquest = yes 		

    start_territory_weight = 25
    territory_power_modifier = 0.5
    
	min_autonomy = 0
    
    # ----- Conditions -----
	trigger = {
        NOT = { has_reform = white_walker_cult_reform }
        NOT = { has_reform = wildling_clan_reform }
        NOT = { has_reform = khalasar_reform }
        NOT = { has_reform = jhattar_reform }
        NOT = { has_reform = pirate_clan_reform }
        NOT = { has_reform = nights_watch_reform }
	}
	
	province_trigger = {
		always = yes
	}

	# ----- Country -----
	country_modifier_happy = {
		global_unrest = -2
		development_cost = -0.2
		production_efficiency = 0.2
	}
	country_modifier_neutral = {
		global_unrest = -1
		development_cost = -0.1
		production_efficiency = 0.1
	}	
	country_modifier_angry = {
		global_unrest = 2
		development_cost = 0.2
		production_efficiency = -0.2
	}	
	
	# ----- Province -----
	province_modifier_happy = {
		local_production_efficiency = 1
	}
	province_modifier_neutral = {
		local_production_efficiency = 0.5
	}	
	province_modifier_angry = {
		local_production_efficiency = -1
		local_unrest = 5
	}	
	
    ai_grant_province = {
        factor = 1    
        
        modifier = {
            factor = 0.5
            development = 20
        }
        modifier = {
            factor = 4
            NOT = { development = 10 }
        }                
        modifier = {
            factor = 4
            local_autonomy = 25
        }
        modifier = {
            factor = 0.25
            NOT = { local_autonomy = 25 }
        }
    }
    
	# ----- Territory -----
    min_territory = 20
    min_provinces_to_want_territory = 5
    
	# ----- Influence -----
	base_influence = 30
	
	influence_modifier = {
		desc = EST_VAL_OTHER_ESTATE_IN_POWER
		trigger = {
			OR = {
				has_country_flag = noble_estate_in_power
                has_country_flag = clergy_estate_in_power
                has_country_flag = merchants_estate_in_power
                has_country_flag = kos_estate_in_power
                has_country_flag = chieftains_estate_in_power
                has_country_flag = magi_estate_in_power
                has_country_flag = slaves_estate_in_power
			}
		}
		influence = -40
	}

    influence_modifier = {
		desc = EST_VAL_COMMON_COUNSEL
		trigger = {
			has_reform = common_counsel_reform
		}
		influence = 10
	}
    
    influence_modifier = {
		desc = EST_VAL_TRIBAL_IDEAGROUP
		trigger = {
			full_idea_group = got_tribal_ideas
		}
		influence = 5
	}
    
    influence_modifier = {
		desc = EST_VAL_HARMONY_IDEAGROUP
		trigger = {
			full_idea_group = got_harmony_ideas
		}
		influence = 5
	}
    
    influence_modifier = {
		desc = EST_VAL_AUTONOMY_IDEAGROUP
		trigger = {
			full_idea_group = got_autonomy_ideas
		}
		influence = 5
	}
    
    influence_modifier = {
		desc = EST_VAL_SOCIETY_IDEAGROUP
		trigger = {
			full_idea_group = got_society_ideas
		}
		influence = 5
	}
    
	# ----- Loyalty -----
	loyalty_modifier = {
		desc = EST_VAL_OTHER_ESTATE_IN_POWER_LOY
		trigger = {
			OR = {
				has_country_flag = noble_estate_in_power
                has_country_flag = clergy_estate_in_power
                has_country_flag = merchants_estate_in_power
                has_country_flag = kos_estate_in_power
                has_country_flag = chieftains_estate_in_power
                has_country_flag = magi_estate_in_power
                has_country_flag = slaves_estate_in_power
			}
		}
		loyalty = -40
	}

    loyalty_modifier = {
		desc = EST_VAL_COMMON_COUNSEL
		trigger = {
			has_reform = common_counsel_reform
		}
		loyalty = 20
	}
    
    loyalty_modifier = {
		desc = EST_VAL_TRIBAL_IDEAGROUP
		trigger = {
			full_idea_group = got_tribal_ideas
		}
		loyalty = 10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_HARMONY_IDEAGROUP
		trigger = {
			full_idea_group = got_harmony_ideas
		}
		loyalty = 10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_AUTONOMY_IDEAGROUP
		trigger = {
			full_idea_group = got_autonomy_ideas
		}
		loyalty = 10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_SOCIETY_IDEAGROUP
		trigger = {
			full_idea_group = got_society_ideas
		}
		loyalty = 10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_ABSOLUTISM_IDEAGROUP
		trigger = {
			full_idea_group = got_absolutism_ideas
		}
		loyalty = -10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_ASSIMILATION_IDEAGROUP
		trigger = {
			full_idea_group = got_assimilation_ideas
		}
		loyalty = -10
	}
    
    loyalty_modifier = {
		desc = EST_VAL_PROPAGANDA_IDEAGROUP
		trigger = {
			full_idea_group = got_propaganda_ideas
		}
		loyalty = -10
	}
    
	# ----- Interactions -----
    # Curtail the Peasantry
    interaction = {
		name = "CURTAIL_THE_PEASANTRY"
		icon = 1
		
        potential = { 
            has_country_flag = commoners_estate_in_power
        }
        
		trigger = {        
            hidden_trigger = { has_country_flag = commoners_estate_in_power } # AI seems to ignore the potential check
            stability = 1
			NOT = { num_of_rebel_armies = 1 }
			NOT = { num_of_rebel_controlled_provinces = 1 }			
			NOT = {
				estate_influence = {
					estate = estate_commoners
					influence = 60
				}				
			}           
        }
		
		effect = {
			add_stability = -3
			add_prestige = -25
			clr_country_flag = commoners_estate_in_power
		}
		
		ai_will_do = {
			factor = 1
		}
	}
    
    # Punish the Commoners
    interaction = {
        name = "PUNISH_THE_COMMONERS"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {        
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 50
            }              
        }
        
        effect = {
            add_estate_loyalty = {
                estate = estate_commoners
                loyalty = -20
            }
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_PUNISHED
                influence = -20
                duration = 7300
            }
        }
        
        ai_will_do = {
            factor = 0
        }
    }
    
    # Enforce Martial Law
    interaction = {
        name = "ENFORCE_MARTIAL_LAW"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {         
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 25
            }            
        }
        
        effect = {
            if = {
                limit = { has_idea = got_absolutism_ideas_3 }
                add_scaled_absolutism = { 
                    ESTATE = estate_commoners
                    LOW = 4
                    MED = 6
                    HIGH = 8
                    MAX = 10
                }
            }
            else = {
                add_scaled_absolutism = { 
                    ESTATE = estate_commoners
                    LOW = 2
                    MED = 4
                    HIGH = 6
                    MAX = 8
                }
            }
            add_estate_loyalty = {
                estate = estate_commoners
                loyalty = -15
            }
        }
        
        ai_will_do = {
            factor = 1

            modifier = {
                factor = 0
                NOT = {
                    estate_loyalty = {
                        estate = estate_commoners
                        loyalty = 50
                    }
                }
            }
        }
    }
    
    # Invest in the Masses
    interaction = {
        name = "INVEST_IN_THE_MASSES"
        icon = 1
        
        years_between_use = 10
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
        }
        
        effect = {
            add_years_of_income = -0.5
            
            add_estate_loyalty = {
                estate = estate_commoners
                loyalty = 15
            }
        }
        
        ai_will_do = {
            factor = 1
            modifier = {
                factor = 0
                NOT = { years_of_income = 1 }                
            }
            modifier = {
                factor = 0
                estate_loyalty = {
                    estate = estate_commoners
                    loyalty = 40
                }
            }            
        }        
    }
    
    # Seek Support of the Commoners
    interaction = {
        name = "SEEK_SUPPORT_OF_COMMONERS"
        icon = 1
        
        years_between_use = 20
        
        potential = {
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
        }
        
        effect = {
            add_estate_loyalty = {
                estate = estate_commoners
                loyalty = 10
            }
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_SUPPORT_OF_COMMONERS
                influence = 10
                duration = 7300
            }
        }
    
        ai_will_do = {
            factor = 1
            modifier = {
                factor = 0
                estate_loyalty = {
                    estate = estate_commoners
                    loyalty = 50
                }                        
            }
            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }                        
            }            
        }
    }
    
    # Recruit Philosopher
    interaction = {
        name = "RECRUIT_PHILOSOPHER"
        icon = 1
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        years_between_use = 30
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }
        }
        
        effect = {
            add_scaled_estate_advisor = { 
                ESTATE = estate_commoners 
                ADVISOR = philosopher
                HIGH = 20
                MED = 10
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_RECRUITED_ADVISOR
                influence = 15
                duration = 10950
            }
        }
        
        
        ai_will_do = {
            factor = 1

            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }                        
            }
        }
    }
    
    # Recruit Artist
    interaction = {
        name = "RECRUIT_ARTIST"
        icon = 1
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        years_between_use = 30
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }
        }
        
        effect = {
            add_scaled_estate_advisor = { 
                ESTATE = estate_commoners 
                ADVISOR = artist
                HIGH = 20
                MED = 10
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_RECRUITED_ADVISOR
                influence = 15
                duration = 10950
            }
        }
        
        
        ai_will_do = {
            factor = 1

            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }                        
            }
        }
    }
    
    # Soothe Peasantry
    interaction = {
        name = "SOOTHE_PEASANTRY"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }            
        }
        
        effect = {
            if = {
                limit = { has_idea = got_harmony_ideas_2 }
                add_stability = 2
            }
            else = {
                add_stability = 1
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_SOOTHED_PEASANTRY
                influence = 10
                duration = 7300
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                
                stability = 3
            }
            
            modifier = {   
                factor = 0
                
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }	
            }
        }
    }
    
    # Celebrate Achievements
    interaction = {
        name = "CELEBRATE_ACHIEVEMENTS"
        icon = 1
        
        years_between_use = 10
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }            
        }
        
        effect = {
            if = {
                limit = { has_idea = got_autonomy_ideas_3 }
                add_scaled_prestige = { 
                    ESTATE = estate_commoners
                    LOW = 10
                    MED = 15
                    HIGH = 20
                    MAX = 25
                }
            }
            else = {
                add_scaled_prestige = { 
                    ESTATE = estate_commoners
                    LOW = 5
                    MED = 10
                    HIGH = 15
                    MAX = 20
                }
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_CELEBRATIONS
                influence = 10
                duration = 3650
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {   
                factor = 0
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }	
            }
        }
    }
    
    # Support Local Mayors
    interaction = {
        name = "SUPPORT_LOCAL_MAYORS"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }            
        }
        
        effect = {
            add_country_modifier = {
                name = popular_administration
                duration = 3650
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_LOCAL_MAYORS
                influence = 10
                duration = 7300
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {   
                factor = 0
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }	
            }
        }
    }
    
    # Exploit Workers
    interaction = {
        name = "EXPLOIT_WORKERS"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }            
        }
        
        effect = {
            add_country_modifier = {
                name = industrious_workers
                duration = 3650
            }
            
            add_estate_loyalty = {
                estate = estate_commoners
                loyalty = -15
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {   
                factor = 0
                NOT = {
                    estate_loyalty = {
                        estate = estate_commoners
                        loyalty = 60
                    }	
                }
            }
        }
    }
    
    # Encourage Freethinkers
    interaction = {
        name = "ENCOURAGE_FREETHINKERS"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = commoners_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = commoners_estate_in_power } }
            estate_loyalty = {
                estate = estate_commoners
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_commoners
                influence = 40
            }            
        }
        
        effect = {
            add_country_modifier = {
                name = freethinkers
                duration = 3650
            }
            
            add_estate_influence_modifier = {
                estate = estate_commoners
                desc = EST_VAL_FREETHINKERS
                influence = 20
                duration = 7300
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {   
                factor = 0
                
                estate_influence = {
                    estate = estate_commoners
                    influence = 60
                }	
            }
        }
    }
}