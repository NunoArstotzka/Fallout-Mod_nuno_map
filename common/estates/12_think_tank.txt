estate_khalasar = {
    icon = 5
    
    color = { 183 142 38 }
    
    keep_on_conquest = no                             
    always_remove_on_religious_conquest = yes         

    start_territory_weight = 100
    territory_power_modifier = 2.0
    
    min_autonomy = 0
    
    independence_government = nomadic
	starting_reform = khalasar_reform
	independence_tech_group = dothraki
	independence_trigger = {
		has_estate = estate_khalasar
	}
    
    # ----- Conditions -----
    trigger = {
        has_reform = khalasar_reform
    }
    
    province_trigger = {
        always = yes
    }
    
    # ----- Country -----
    country_modifier_happy = {
        cavalry_power = 0.2
        land_maintenance_modifier = -0.5
        land_forcelimit_modifier = 0.5
    }
    country_modifier_neutral = {
        cavalry_power = 0.1
        land_maintenance_modifier = -0.25
        land_forcelimit_modifier = 0.25
    }    
    country_modifier_angry = {
        cavalry_power = -0.2
        land_maintenance_modifier = 0.5
        land_forcelimit_modifier = -0.5
    }
    
    # ----- Province -----
    province_modifier_happy = {
        local_manpower_modifier = 1.0
        local_regiment_cost = -0.5
    }
    province_modifier_neutral = {
        local_manpower_modifier = 0.5
        local_regiment_cost = -0.25
    }
    province_modifier_angry = {
        local_manpower_modifier = -1.0
        local_regiment_cost = 0.5
        local_unrest = 5
    }    
    
    ai_grant_province = {
        factor = 1    
        modifier = {
            factor = 0.5
            development = 20
        }
        modifier = {
            factor = 2
            NOT = { development = 10 }
        }                
        modifier = {
            factor = 0.75
            has_owner_culture = yes
        }
        modifier = {
            factor = 0.75
            province_trade_power = 5
        }            
        modifier = {
            factor = 0.75
            province_trade_power = 10
        }
        modifier = {
            factor = 4
            local_autonomy = 25
        }
        modifier = {
            factor = 0.25
            NOT = { local_autonomy = 25 }
        }
    }   
    
    # ----- Territory -----
    min_territory = 50
    min_provinces_to_want_territory = 5        
    
    ai_territory_modifier = {
		trigger = {
			always = yes
		}	
		value = 100
	}
    
    # ----- Influence -----
    base_influence = 30

    influence_modifier = {
        desc = EST_VAL_OTHER_ESTATE_IN_POWER
        trigger = {
            has_country_flag = slaves_estate_in_power
        }
        influence = -40
    }
    
    influence_modifier = {
		desc = EST_VAL_KO_COUNSEL
		trigger = {
			has_reform = ko_counsel_reform
		}
		influence = 10
	}
    
    influence_modifier = {
		desc = EST_VAL_NOMADIC_IDEAGROUP
		trigger = {
			full_idea_group = got_nomadic_ideas
		}
		influence = 10
	}
    
    # ----- Loyalty -----
    loyalty_modifier = {
        desc = EST_VAL_OTHER_ESTATE_IN_POWER_LOY
        trigger = {
            has_country_flag = slaves_estate_in_power
        }
        loyalty = -40
    }

    loyalty_modifier = {
        desc = EST_VAL_HORDE_UNITY
        trigger = {
            has_reform = khalasar_reform
            horde_unity = 75
        }
        loyalty = 10
    }
    
    loyalty_modifier = {
        desc = EST_VAL_HORDE_UNITY
        trigger = {
            has_reform = khalasar_reform
            NOT = { horde_unity = 50 }
        }
        loyalty = -10
    }

    loyalty_modifier = {
		desc = EST_VAL_KO_COUNSEL
		trigger = {
			has_reform = ko_counsel_reform
		}
		loyalty = 20
	}
    
    loyalty_modifier = {
		desc = EST_VAL_NOMADIC_IDEAGROUP
		trigger = {
			full_idea_group = got_nomadic_ideas
		}
		loyalty = 10
	}
    
    # ----- Interactions -----
    # Curtail the Kos
    interaction = {
		name = "CURTAIL_THE_KOS"
		icon = 1
		
        potential = { 
            has_country_flag = kos_estate_in_power
        }
        
		trigger = {      
            hidden_trigger = { has_country_flag = kos_estate_in_power } # AI seems to ignore the potential check
            stability = 1
			NOT = { num_of_rebel_armies = 1 }
			NOT = { num_of_rebel_controlled_provinces = 1 }			
			NOT = {
				estate_influence = {
					estate = estate_khalasar
					influence = 60
				}				
			}           
        }
		
		effect = {
			add_stability = -3
			add_prestige = -25
			clr_country_flag = kos_estate_in_power
		}
		
		ai_will_do = {
			factor = 1
		}
	}
    
    # Punish the Kos
    interaction = {
        name = "PUNISH_THE_KOS"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {        
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 50
            }              
        }
        
        effect = {
            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = -20
            }
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_PUNISHED
                influence = -20
                duration = 7300
            }
        }
        
        ai_will_do = {
            factor = 0
        }
    }
    
    # Exhort Strength
    interaction = {
        name = "EXHORT_STRENGTH"
        icon = 1
        
        years_between_use = 20
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {        
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_khalasar
                influence = 25
            }            
        }
        
        effect = {
            if = {
                limit = { has_idea = got_nomadic_ideas_3 }
                add_scaled_mil_power = { 
                    ESTATE = estate_khalasar
                    LOW = 100
                    MED = 150
                    HIGH = 200
                    MAX = 250
                }
            }
            else = {
                add_scaled_mil_power = { 
                    ESTATE = estate_khalasar
                    LOW = 50
                    MED = 100
                    HIGH = 150
                    MAX = 200
                }
            }

            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = -20
            }
        }
        
        ai_will_do = {
            factor = 1

            modifier = {
                factor = 0
                NOT = {
                    estate_loyalty = {
                        estate = estate_khalasar
                        loyalty = 50
                    }
                }
            }
        }
    }
    
    # Admonish Greed
    interaction = {
        name = "ADMONISH_GREED"
        icon = 1
        
        years_between_use = 10
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
        }
        
        effect = {
            add_years_of_income = -0.5
            
            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = 15
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                NOT = { years_of_income = 1 }                
            }
            
            modifier = {
                factor = 0
                estate_loyalty = {
                    estate = estate_khalasar
                    loyalty = 50
                }
            }            
        }        
    }
    
    # Assemble Bloodriders
    interaction = {
        name = "ASSEMBLE_BLOODRIDERS"
        icon = 1
        
        years_between_use = 20
        
        potential = {
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
        }
        
        effect = {
            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = 10
            }
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_ASSEMBLED_BLOODRIDERS
                influence = 10
                duration = 7300
            }
        }
    
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                estate_loyalty = {
                    estate = estate_khalasar
                    loyalty = 50
                }                        
            }
            
            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_khalasar
                    influence = 60
                }                        
            }            
        }
    }
    
    # Recruit Commandant
    interaction = {
        name = "RECRUIT_FURRIER"
        icon = 1
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        years_between_use = 30
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }
        }
        
        effect = {
            add_scaled_estate_advisor = { 
                ESTATE = estate_khalasar 
                ADVISOR = furrier
                HIGH = 20
                MED = 10
            }
            
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_RECRUITED_ADVISOR
                influence = 15
                duration = 10950
            }
        }
        
        
        ai_will_do = {
            factor = 1

            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_khalasar
                    influence = 60
                }                        
            }
        }
    }
    
    # Recruit Army Reformer
    interaction = {
        name = "RECRUIT_STABLEMASTER"
        icon = 1
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        years_between_use = 30
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }
        }
        
        effect = {
            add_scaled_estate_advisor = { 
                ESTATE = estate_khalasar 
                ADVISOR = stablemaster
                HIGH = 20
                MED = 10
            }
            
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_RECRUITED_ADVISOR
                influence = 15
                duration = 10950
            }
        }
        
        
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_khalasar
                    influence = 60
                }                        
            }
        }
    }
    
    
    # Appoint Kos
    interaction = {
        name = "APPOINT_KOS"
        icon = 1
        
        years_between_use = 10
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 30
            }    
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }            
        }
        
        effect = {
            if = {
                limit = { has_idea = got_nomadic_ideas_5 }
                add_scaled_general = { 
                    ESTATE = estate_khalasar
                    LOW = 50
                    MED = 75
                    HIGH = 100
                    MAX = 100
                }
            }
            else = {
                add_scaled_general = { 
                    ESTATE = estate_khalasar
                    LOW = 25
                    MED = 50
                    HIGH = 75
                    MAX = 100
                }
            }
            
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_RECRUITED_LEADER
                influence = 15
                duration = 3650
            }
        }
        
        ai_will_do = {
            factor = 1
            
            modifier = {
                factor = 0
                estate_influence = {
                    estate = estate_khalasar
                    influence = 60
                }                        
            }
        }
    }
    
    # Rally Arakhs
    interaction = {
        name = "RALLY_ARAKHS"
        icon = 1
        
        years_between_use = 15
        
        potential = {
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 30
            }
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }
        }
        
        effect = {
            if = {
                limit = { has_idea = got_nomadic_ideas_4 }
                add_scaled_yearly_manpower = { 
                    ESTATE = estate_khalasar
                    LOW = 0.5
                    MED = 0.75
                    HIGH = 1.0
                    MAX = 1.25
                }
            }
            else = {
                add_scaled_yearly_manpower = { 
                    ESTATE = estate_khalasar
                    LOW = 0.25
                    MED = 0.5
                    HIGH = 0.75
                    MAX = 1.0
                }
            }

            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = -15
            }
        }
        
        ai_will_do = {
            factor = 1
            modifier = {
                factor = 0
                NOT = {
                    estate_loyalty = {
                        estate = estate_khalasar
                        loyalty = 50
                    }    
                }
            }
            modifier = {
                factor = 0
                manpower_percentage = 0.75                
            }         
        }
    }
    
    # Mobilize Khalasar
    interaction = {
        name = "MOBILIZE_KHALASAR"
        icon = 1
        
        years_between_use = 25
        
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
        trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 30
            }
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }
        }
        
        effect = {
            if = {
                limit = { has_idea = got_nomadic_ideas_1 }
                add_scaled_war_exhaustion = { 
                    ESTATE = estate_khalasar
                    LOW = -4
                    MED = -6
                    HIGH = -8
                    MAX = -10
                }
            }
            else = {
                add_scaled_war_exhaustion = { 
                    ESTATE = estate_khalasar
                    LOW = -2
                    MED = -4
                    HIGH = -6
                    MAX = -8
                }
            }

            add_estate_loyalty = {
                estate = estate_khalasar
                loyalty = -10
            }
            add_estate_influence_modifier = {
                estate = estate_khalasar
                desc = EST_VAL_MOBILIZED_KHALASAR
                influence = 10
                duration = 3650
            }
        }
        
        ai_will_do = {
            factor = 1
            modifier = {
                factor = 0
                NOT = {
                    estate_loyalty = {
                        estate = estate_khalasar
                        loyalty = 50
                    }    
                }
            }
            modifier = {
                factor = 0
                NOT = { war_exhaustion = 10 }
            }          
        }
    }
    
    # Muster Cavalry
    interaction = {
		name = "MUSTER_CAVALRY"
		icon = 1
		
		years_between_use = 10
		
        potential = { 
            NOT = { has_country_flag = kos_estate_in_power }
        }
        
		trigger = {
            hidden_trigger = { NOT = { has_country_flag = kos_estate_in_power } }
            estate_loyalty = {
                estate = estate_khalasar
                loyalty = 30
            }
            estate_influence = {
                estate = estate_khalasar
                influence = 40
            }
            
            custom_trigger_tooltip = {
				tooltip = TT_OWN_KOS_PROVINCE
				any_owned_province = {
					has_estate = estate_khalasar
				}
			}
        }
		
		effect = {
            custom_tooltip = TT_SPAWN_KOS_CAVALRY
            
            hidden_effect = {
				capital_scope = {
					cavalry = ROOT
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 2
									has_estate = estate_khalasar
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 3
									has_estate = estate_khalasar
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 4
									has_estate = estate_khalasar
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 5
									has_estate = estate_khalasar
                                }
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 6
									has_estate = estate_khalasar
								}
								estate_influence = {
									estate = estate_khalasar
									influence = 60
								}
							}
						
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 7
									has_estate = estate_khalasar
								}
								estate_influence = {
									estate = estate_khalasar
									influence = 60
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 8
									has_estate = estate_khalasar
								}
								estate_influence = {
									estate = estate_khalasar
									influence = 60
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 9
									has_estate = estate_khalasar
								}
								estate_influence = {
									estate = estate_khalasar
									influence = 60
								}
							}
						}
						cavalry = ROOT
					}
					if = {
						limit = {
							owner = {
								num_of_owned_provinces_with = {
									value = 10
									has_estate = estate_khalasar
								}
								estate_influence = {
									estate = estate_khalasar
									influence = 60
								}
							}
						}
						cavalry = ROOT
					}
				}
            }
            
            add_estate_loyalty = {
				estate = estate_khalasar
				loyalty = -10
			}
            
            add_estate_influence_modifier = {
				estate = estate_khalasar
				desc = EST_VAL_MUSTERED_CAVALRY
				influence = 10
				duration = 3650
			}
		}
		
		ai_will_do = {
			factor = 1
            
            modifier = {   
                factor = 0
                estate_influence = {
                    estate = estate_khalasar
                    influence = 60
                }	
            }
		}
	}
}