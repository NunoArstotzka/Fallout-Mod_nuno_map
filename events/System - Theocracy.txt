########################################
# Events for Theocracy
#
# written by Johan Andersson
########################################

namespace = theocracy

country_event = {
	id = theocracy.1
	title = theocracy.1.title
	desc = theocracy.1.desc
	picture = RELIGION_eventPicture

	is_triggered_only = yes

	trigger = {
        government = theocracy
        NOT = { has_reform = brotherhood_reform }
		NOT = { has_country_flag = in_theocracy_heir_selection }
	}

	immediate = {
		hidden_effect = {
			set_country_flag = in_theocracy_heir_selection
			
			clr_country_flag = theo_local_noble_flag
			clr_country_flag = theo_foreign_noble_flag
			clr_country_flag = theo_merchants_son_flag
			clr_country_flag = theo_talented_theologian_flag
			clr_country_flag = theo_local_preacher_flag
			clr_country_flag = theo_papal_protege_flag
			clr_country_flag = theo_imam_khatib_flag
			
			#Local Noble,etc:
			if = {
				limit = {
					any_owned_province = {
						has_estate = estate_bureaucrats
					}
				}
				random_owned_province = {
					limit = { has_estate = estate_bureaucrats }
					save_event_target_as = noble_province
				}
			}
			#Local Noble:
			if = {
				limit = {
					any_owned_province = {
						has_estate = estate_bureaucrats
					}
				}
				random_owned_province = {
					limit = { has_estate = estate_bureaucrats }
					save_event_target_as = noble_province
				}
			}
			if = {
				limit = {
					any_owned_province = {
						has_estate = estate_caravanners
					}
				}
				random_owned_province = {
					limit = { has_estate = estate_caravanners }
					save_event_target_as = burgher_province
				}
			}
			if = {
				limit = {
					any_owned_province = {
						has_estate = estate_scientists
					}
				}
				random_owned_province = {
					limit = { has_estate = estate_scientists }
					save_event_target_as = science_province
				}
			}
			if = {
				limit = {
					any_owned_province = {
						has_estate = estate_settlers
					}
				}
				random_owned_province = {
					limit = { has_estate = estate_settlers }
					save_event_target_as = laity_province
				}
			}
		}
	}

	option = {
		name = theocracy.1.a		# A Pious Bureaucrat
		trigger = 	{
			NOT = { tag = RNC }
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = 15
			}
		}
		set_country_flag = theo_local_noble_flag # USED IN DEVOTION.TXT
		if = {
			limit = {
				has_saved_event_target = noble_province
			}
			define_heir = {
				age = 35
				hidden = yes
				culture = event_target:noble_province
			}
		}
		else = {
			define_heir = {
				age = 35
				hidden = yes
				culture = ROOT
			}
		}
		add_devotion = -5
		add_prestige = 10
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}

	option = {
		name = theocracy.1.b		# A Foreign Noble

		trigger = {
			any_neighbor_country = {
				has_regency = no
				religion = ROOT
			}
			NOT = { tag = RNC }
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = -5
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_settlers
			}
			add_estate_loyalty = {
				estate = estate_settlers
				loyalty = -10
			}
		}		
		set_country_flag = theo_foreign_noble_flag # USED IN DEVOTION.TXT
		random_neighbor_country = { 
			limit = {
				has_regency = no
				religion = ROOT
			}
			ROOT = { 
				define_heir = { 
					dynasty = PREV 
					age = 35
					culture = PREV
					hidden = yes
					religion = ROOT
				} 
			}
			add_opinion = { who = ROOT modifier = opinion_theocracy_noble }
		}
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}

	option = {
		name = theocracy.1.c		# A Merchant's Son
		trigger = {
			NOT = { tag = RNC }
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_caravanners
			}
			add_estate_loyalty = {
				estate = estate_caravanners 
				loyalty = 15
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = -15
			}
		}
		set_country_flag = theo_merchants_son_flag # USED IN DEVOTION.TXT
		
		if = {
			limit = {
				has_saved_event_target = burgher_province
			}
			define_heir = {
				age = 35
				hidden = yes
				culture = event_target:burgher_province
			}
		}
		else = {
			define_heir = {
				age = 35
				hidden = yes
			}
		}
		add_years_of_income = 0.35
		add_devotion = -5
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}

	option = {
		name = theocracy.1.e		# A Talented Theologian
		set_country_flag = theo_talented_theologian_flag # USED IN DEVOTION.TXT
		trigger = {
			NOT = { tag = RNC }
		}
		define_heir = {
			age = 35
			hidden = yes
		}
		add_devotion = 10
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}
	option = {
		name = theocracy.1.f		# A low-level priest
		trigger = {
			NOT = { religion_group = religion_group_muslim }
			NOT = { tag = RNC }
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_settlers
			}
			add_estate_loyalty = {
				estate = estate_settlers
				loyalty = 15
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = -15
			}
		}
		set_country_flag = theo_local_preacher_flag # USED IN DEVOTION.TXT
		if = {
			limit = {
				has_saved_event_target = laity_province
			}
			define_heir = {
				age = 35
				hidden = yes
				culture = event_target:laity_province
			}
		}
		else = {
			define_heir = {
				age = 35
				hidden = yes
			}
		}
		add_devotion = 10
		add_prestige = -5
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}
	option = {
		name = theocracy.1.g		# A Local Imam Khatib
		trigger = {
			religion_group = religion_group_muslim
			NOT = { tag = RNC }
		}
		set_country_flag = theo_imam_khatib_flag # USED IN DEVOTION.TXT
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_settlers
			}
			add_estate_loyalty = {
				estate = estate_settlers
				loyalty = 15
			}
		}
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = -15
			}
		}		
		define_heir = {
			age = 35
			hidden = yes
		}
		add_devotion = 10
		add_prestige = -10
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}
	option = {
		name = theocracy.1.h		# A believing Scientist
		set_country_flag = theo_influential_reformer_flag # USED IN DEVOTION.TXT
		trigger = { NOT = { tag = RNC } }
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_scientists
			}
			add_estate_loyalty = {
				estate = estate_scientists
				loyalty = 15
			}
		}		
		if = {
			limit = {
				has_dlc = "The Cossacks"
				has_estate = estate_bureaucrats
			}
			add_estate_loyalty = {
				estate = estate_bureaucrats
				loyalty = -5
			}
		}
		if = {
			limit = {
				has_saved_event_target = science_province
			}
			define_heir = {
				age = 35
				hidden = yes
				culture = event_target:science_province
			}
		}
		else = {
			define_heir = {
				age = 35
				hidden = yes
			}
		}
		add_fervor = 10
		add_church_power = 10
		add_prestige = -10
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}
	
	option = {
		name = theocracy.1.i # The Renewal Cult always appoints Brain's brother/son (not sure which one)
		trigger = {
			tag = RNC
		}
		set_country_flag = theo_naked_mole_rat # USED IN DEVOTION.TXT
		define_heir = {
			name = "Zomak"
			dynasty = "Ra'at"
			adm = 5
			dip = 5
			mil = 5
			culture = mole_rat
		}
		add_heir_personality = immortal_personality
		add_heir_personality = tolerant_personality
		add_devotion = 10
		add_prestige = -10
		clr_country_flag = in_theocracy_heir_selection
		custom_tooltip = theocracy.1.tt
	}

	option = {
		name = theocracy.1.j # Renewal states can be led by sentient mole rats
		trigger = {
			religion = renewal
			NOT = { tag = RNC }
		}
		set_country_flag = theo_naked_mole_rat # USED IN DEVOTION.TXT
		define_heir = {
			culture = mole_rat
			adm = 5
			dip = 5
			mil = 5
			hidden = yes
		}
		add_heir_personality = immortal_personality
		add_heir_personality = tolerant_personality
	}
}

# Problematic Relations
country_event = {
	id =  theocracy.101
	title = "EVTNAME1091"
	desc = "EVTDESC1091"
	picture = DIPLOMACY_eventPicture

	trigger = {
		NOT = { has_country_flag = problematic_relations }
		government = theocracy
        NOT = { has_reform = brotherhood_reform }
		any_neighbor_country = {
			NOT = { has_opinion = { who = ROOT value = -50 } }
			NOT = { religion = ROOT }
		}
	}

	mean_time_to_happen = {
		months = 180

		modifier = {
			factor = 0.9
			is_defender_of_faith = yes
		}
		modifier = {
			factor = 0.9
			mil = 7
		}
		modifier = {
			factor = 0.9
			mil = 8
		}
		modifier = {
			factor = 0.9
			mil = 9
		}
		modifier = {
			factor = 1.2
			NOT = { mil= 4 }
		}
	}
	
	option = {
		name = "EVTOPTA1091" # Make your opinion clear to them
		ai_chance = { factor = 45 }
		set_country_flag = problematic_relations
		random_country = {
			limit = {
				is_neighbor_of = ROOT
				NOT = { religion = ROOT }
				NOT = { has_opinion = { who = ROOT value = -50 } }
			}
			add_opinion = { who = ROOT modifier = opinion_forceful_conversion }
		}	
	}
	option = {
		name = "EVTOPTB1091" # Make preparations for a future attack
		ai_chance = { factor = 55 }
		set_country_flag = problematic_relations
		add_army_tradition = 15
		add_treasury = -40
	}
}

